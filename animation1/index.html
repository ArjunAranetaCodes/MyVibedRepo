<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gooey Lava Lamp</title>
<style>
  html, body {
    height: 100%;
    margin: 0;
    background: #0b0f14; /* backdrop */
    overflow: hidden;
  }
  /* Optional subtle gradient background */
  body::before {
    content: "";
    position: fixed;
    inset: -20%;
    background: radial-gradient(60% 60% at 30% 30%, #0f223a 0%, #0b0f14 60%) no-repeat;
    filter: blur(40px);
    opacity: 0.8;
    z-index: -1;
  }
  svg {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    display: block;
  }
  /* Initial tint (JS will override with animated HSL) */
  .blob { fill: #7fd1ff; }
  .blob.alt { fill: #66ffa6; }
</style>
</head>
<body>
  <div id="timer" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);color:#ffffff;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-weight:700;letter-spacing:0.06em;background:rgba(0,0,0,0.18);padding:14px 22px;border-radius:14px;z-index:10;font-size:96px;line-height:1;">01:00</div>
  <button id="burger" aria-label="Settings" title="Settings" style="position:fixed;top:12px;right:12px;width:44px;height:44px;display:grid;place-items:center;background:rgba(0,0,0,0.32);backdrop-filter: blur(6px);-webkit-backdrop-filter: blur(6px);border:none;border-radius:12px;cursor:pointer;z-index:12;outline:none;">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect x="3" y="6" width="18" height="2" rx="1" fill="#ffffff"/>
      <rect x="3" y="11" width="18" height="2" rx="1" fill="#ffffff"/>
      <rect x="3" y="16" width="18" height="2" rx="1" fill="#ffffff"/>
    </svg>
  </button>
  <button id="timerIcon" aria-label="Timer" title="Timer" style="position:fixed;top:12px;right:60px;width:44px;height:44px;display:grid;place-items:center;background:rgba(0,0,0,0.32);backdrop-filter: blur(6px);-webkit-backdrop-filter: blur(6px);border:none;border-radius:12px;cursor:pointer;z-index:11;outline:none;">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="12" cy="13" r="7" stroke="#ffffff" stroke-width="2" fill="none"/>
      <path d="M12 9v4l3 2" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <rect x="9" y="3" width="6" height="2" rx="1" fill="#ffffff"/>
    </svg>
  </button>
  <div id="timerPanel" style="position:fixed;top:60px;right:60px;display:none;z-index:13;background:rgba(0,0,0,0.55);backdrop-filter: blur(8px);-webkit-backdrop-filter: blur(8px);border-radius:14px;padding:14px 16px;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:#ffffff;">
    <label for="minutesInput" style="display:block;font-size:13px;opacity:0.95;margin-bottom:8px;">Minutes</label>
    <div style="display:flex;gap:10px;align-items:center;">
      <input id="minutesInput" type="number" min="1" max="180" step="1" value="1" style="width:96px;padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.25);background:rgba(0,0,0,0.25);color:#ffffff;outline:none;font-size:16px;" />
      <button id="applyMinutes" style="padding:8px 12px;border:none;border-radius:10px;background:#3aa6ff;color:#081018;font-weight:700;cursor:pointer;font-size:14px;">Set</button>
    </div>
  </div>
  <!-- Full-screen SVG with a gooey filter -->
  <svg viewBox="0 0 1000 1000" preserveAspectRatio="xMidYMid slice" aria-hidden="true">
    <defs>
      <!-- Gooey: blur then enhance alpha -->
      <filter id="goo">
        <feGaussianBlur in="SourceGraphic" stdDeviation="18" result="blur" />
        <feColorMatrix in="blur" mode="matrix"
          values="
            1 0 0 0 0
            0 1 0 0 0
            0 0 1 0 0
            0 0 0 35 -15" result="goo" />
        <feBlend in="SourceGraphic" in2="goo" />
      </filter>
    </defs>

    <!-- Apply goo filter to all blobs -->
    <g filter="url(#goo)" id="blobGroup">
      <!-- Circles will be populated/updated by JS -->
      <!-- You can pre-seed a few if you want fallback visuals -->
      <circle class="blob" cx="300" cy="300" r="80" />
      <circle class="blob alt" cx="700" cy="700" r="90" />
    </g>
  </svg>

<script>
  (function () {
    const svg = document.querySelector('svg');
    const group = document.getElementById('blobGroup');
    const burger = document.getElementById('burger');
    const timerIcon = document.getElementById('timerIcon');

    // Coordinate space matches viewBox (0..1000)
    const WIDTH = 1000;
    const HEIGHT = 1000;

    const NUM_BLOBS = 10;
    const MIN_R = 50;
    const MAX_R = 120;
    const MAX_SPEED = 0.12; // slower motion
    const PULSE_AMPL = 0.16; // slightly subtler
    const PULSE_SPEED = 0.0012; // slower pulsation
    const HUE_SPEED_MIN = 0.002; // deg/ms (very slow)
    const HUE_SPEED_MAX = 0.008; // deg/ms

    // Reuse or create circles
    function ensureCircles(n) {
      const existing = group.querySelectorAll('circle');
      for (let i = existing.length; i < n; i++) {
        const c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        c.setAttribute('class', i % 2 ? 'blob' : 'blob alt');
        group.appendChild(c);
      }
      return group.querySelectorAll('circle');
    }

    const circles = ensureCircles(NUM_BLOBS);

    // Blob model
    const blobs = Array.from({ length: NUM_BLOBS }, (_, i) => {
      const r = rand(MIN_R, MAX_R);
      return {
        cx: rand(r, WIDTH - r),
        cy: rand(r, HEIGHT - r),
        rBase: r,
        vx: rand(-MAX_SPEED, MAX_SPEED),
        vy: rand(-MAX_SPEED, MAX_SPEED),
        phase: Math.random() * Math.PI * 2,
        hue: Math.random() * 360,
        sat: rand(70, 95),
        lit: rand(55, 65),
        hueSpeed: (Math.random() < 0.5 ? 1 : -1) * rand(HUE_SPEED_MIN, HUE_SPEED_MAX),
        el: circles[i]
      };
    });

    // Assign random static colors to each blob
    for (const b of blobs) {
      const { r, g, b: bb } = hslToRgb(b.hue, b.sat, b.lit);
      b.el.style.fill = `rgb(${r}, ${g}, ${bb})`;
    }

    // Animation loop
    let DURATION_MS = 60 * 1000; // 1 minute (can change via menu)
    const timerEl = document.getElementById('timer');
    let startTime = performance.now();
    let last = startTime;
    let stopped = false;
    function frame(now) {
      const dt = now - last; // ms
      last = now;
      const elapsed = now - startTime;
      const remaining = Math.max(0, DURATION_MS - elapsed);
      timerEl.textContent = formatRemaining(remaining);

      for (const b of blobs) {
        // Move
        b.cx += b.vx * dt;
        b.cy += b.vy * dt;

        // Bounce on edges (account for current pulsating radius)
        const rPulse = b.rBase * (1 + PULSE_AMPL * Math.sin(b.phase));
        if (b.cx < rPulse && b.vx < 0) b.vx *= -1;
        if (b.cx > WIDTH - rPulse && b.vx > 0) b.vx *= -1;
        if (b.cy < rPulse && b.vy < 0) b.vy *= -1;
        if (b.cy > HEIGHT - rPulse && b.vy > 0) b.vy *= -1;

        // Pulsate
        b.phase += PULSE_SPEED * dt;
        const r = b.rBase * (1 + PULSE_AMPL * Math.sin(b.phase));

        // Color drift
        b.hue = (b.hue + b.hueSpeed * dt) % 360;
        const rgb = hslToRgb(b.hue, b.sat, b.lit);

        // Write to DOM
        b.el.setAttribute('cx', b.cx.toFixed(2));
        b.el.setAttribute('cy', b.cy.toFixed(2));
        b.el.setAttribute('r', r.toFixed(2));
        b.el.style.fill = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
      }

      if (remaining > 0) {
        requestAnimationFrame(frame);
      } else {
        stopped = true;
      }
    }

    requestAnimationFrame(frame);

    // Placeholder click handler for settings (no-op for now)
    burger.addEventListener('click', function(){
      // Implement settings panel here
      console.log('Settings clicked');
    });
    timerIcon.addEventListener('click', function(){
      console.log('Timer icon clicked');
    });

    // Hover menu logic
    const panel = document.getElementById('timerPanel');
    const minutesInput = document.getElementById('minutesInput');
    const applyMinutes = document.getElementById('applyMinutes');

    // Click to toggle timer panel; keep open while interacting
    timerIcon.addEventListener('click', function(e){
      e.stopPropagation();
      const willShow = panel.style.display !== 'block';
      panel.style.display = willShow ? 'block' : 'none';
      if (willShow) {
        setTimeout(()=>{ minutesInput.focus(); minutesInput.select(); }, 0);
      }
    });
    panel.addEventListener('click', function(e){ e.stopPropagation(); });
    document.addEventListener('click', function(){
      panel.style.display = 'none';
    });
    function applyNewMinutes(){
      const minutes = Math.max(1, Math.min(180, parseInt(minutesInput.value, 10) || 1));
      minutesInput.value = String(minutes);
      DURATION_MS = minutes * 60 * 1000;
      startTime = performance.now();
      last = startTime;
      stopped = false;
      timerEl.textContent = formatRemaining(DURATION_MS);
      panel.style.display = 'none';
      requestAnimationFrame(frame);
    }
    applyMinutes.addEventListener('click', applyNewMinutes);
    minutesInput.addEventListener('keydown', function(e){ if (e.key === 'Enter') applyNewMinutes(); });

    function formatRemaining(ms){
      const totalSeconds = Math.ceil(ms / 1000);
      const clamped = Math.max(0, totalSeconds);
      const mm = Math.floor(clamped / 60);
      const ss = clamped % 60;
      return `${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
    }

    // Handle resize: preserve aspect via preserveAspectRatio
    // If you'd like the coordinate space to adapt, recompute viewBox here.

    // Utils
    function rand(min, max) {
      return Math.random() * (max - min) + min;
    }
    function hslToRgb(h, s, l) {
      // h in degrees [0,360), s and l in percent [0,100]
      const hh = ((h % 360) + 360) % 360 / 360;
      const ss = s / 100;
      const ll = l / 100;
      if (ss === 0) {
        const v = Math.round(ll * 255);
        return { r: v, g: v, b: v };
      }
      const q = ll < 0.5 ? ll * (1 + ss) : ll + ss - ll * ss;
      const p = 2 * ll - q;
      const r = Math.round(hue2rgb(p, q, hh + 1/3) * 255);
      const g = Math.round(hue2rgb(p, q, hh) * 255);
      const b = Math.round(hue2rgb(p, q, hh - 1/3) * 255);
      return { r, g, b };
    }
    function hue2rgb(p, q, t) {
      if (t < 0) t += 1;
      if (t > 1) t -= 1;
      if (t < 1/6) return p + (q - p) * 6 * t;
      if (t < 1/2) return q;
      if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
      return p;
    }
  })();
</script>
</body>
</html>

